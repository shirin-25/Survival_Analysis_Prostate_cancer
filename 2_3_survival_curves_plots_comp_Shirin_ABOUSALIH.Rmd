---
title: "SA_Shirin_Abousalih"
author: "Shirin ABOUSALIH"
date: "2024-08-20"
output: pdf_document
---
#2)Summary survival statistics 
```{r}
library(asaur)
library(survival)

# Load the dataset
data("prostateSurvival")

# View the first few rows of the dataset
head(prostateSurvival)

# See the structure of the dataset
str(prostateSurvival)

# Summarize the dataset
summary(prostateSurvival)

# Check the column names in the dataset
colnames(prostateSurvival)

# Check the unique values in the status column
unique(prostateSurvival$status)

# Drop rows where status is 2
prostateSurvival <- prostateSurvival[prostateSurvival$status != 2, ]

# Convert 'status' to a binary event indicator (1 = event, 0 = censored)
# Here, we assume 1 indicates the event (e.g., death) and 0 indicates censoring
prostateSurvival$status <- ifelse(prostateSurvival$status == 1, 1, 0)

# Convert 'survTime' to numeric if it's not already
prostateSurvival$survTime <- as.numeric(as.character(prostateSurvival$survTime))

# Create the survival object using the Kaplan-Meier estimator
surv_obj <- Surv(time = prostateSurvival$survTime, event = prostateSurvival$status)

# Fit a survival curve without grouping (overall summary)
surv_fit <- survfit(surv_obj ~ 1)

# Summary of the survival fit
summary(surv_fit)

# Plot the overall survival curve
plot(surv_fit, main = "Overall Kaplan-Meier Survival Curve", xlab = "Time", ylab = "Survival Probability")

```
#3) Survival curves plots and curves comparison 
```{r}
# Fit survival curves by 'stage'
surv_fit_stage <- survfit(Surv(time = prostateSurvival$survTime, event = prostateSurvival$status) ~ stage, data = prostateSurvival)

# Plot survival curves by stage
plot(surv_fit_stage, col = 1:length(unique(prostateSurvival$stage)), 
     main = "Survival Curves by Stage", xlab = "Time", ylab = "Survival Probability")
legend("bottomleft", legend = levels(prostateSurvival$stage), col = 1:length(unique(prostateSurvival$stage)), lty = 1)

```
```{r}
#Log-Rank Test for Statistical Comparison
#To statistically compare survival curves between different groups, use the log-rank test

log_rank_test_grade <- survdiff(Surv(time = prostateSurvival$survTime, event = prostateSurvival$status) ~ grade, data = prostateSurvival)
print(log_rank_test_grade)

```

```{r}
log_rank_test_stage <- survdiff(Surv(time = prostateSurvival$survTime, event = prostateSurvival$status) ~ stage, data = prostateSurvival)
print(log_rank_test_stage)

```
```{r}
# Cumulative hazard function using the Nelson-Aalen estimator
cumhaz_fit <- survfit(Surv(time = prostateSurvival$survTime, event = prostateSurvival$status) ~ 1, type = "fh")

# Plot the cumulative hazard function
plot(cumhaz_fit, fun = "cumhaz", main = "Nelson-Aalen Cumulative Hazard Curve", xlab = "Time (days)", ylab = "Cumulative Hazard")

```
```{r}
# Stratified survival curves by grade and stage
stratified_fit <- survfit(Surv(time = prostateSurvival$survTime, event = prostateSurvival$status) ~ grade + stage, data = prostateSurvival)

# Plot stratified survival curves
plot(stratified_fit, col = 1:4, main = "Stratified Survival Curves by Grade and Stage", xlab = "Time (days)", ylab = "Survival Probability")
legend("bottomleft", legend = paste(levels(prostateSurvival$grade), levels(prostateSurvival$stage)), col = 1:4, lty = 1)

```
```{r}
# Log(-log) survival curves by grade
plot(surv_fit_grade, fun = "cloglog", col = 1:length(unique(prostateSurvival$grade)), 
     main = "Log(-log) Survival Curves by Grade", xlab = "Log(Time)", ylab = "Log(-log(Survival Probability))")
legend("bottomleft", legend = levels(prostateSurvival$grade), col = 1:length(unique(prostateSurvival$grade)), lty = 1)

```
```{r}
# Create a plot
plot(0, 0, type = "n", xlim = c(0, max(times)), ylim = c(0, 1), 
     xlab = "Time", ylab = "Survival Probability", 
     main = "Weibull Survival Curves by Stage")

# Add curves for each stage
for (i in seq_along(stages)) {
  stage_data <- prostateSurvival[prostateSurvival$stage == stages[i], ]
  fit <- survreg(Surv(survTime, status) ~ 1, data = stage_data, dist = "weibull")
  shape <- 1 / fit$scale
  scale <- exp(coef(fit))
  
  survival_prob <- pweibull(times, shape, scale, lower.tail = FALSE)
  
  lines(times, survival_prob, col = i)
}

legend("bottomleft", legend = stages, col = 1:length(stages), lty = 1)

```



